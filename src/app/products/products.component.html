<div class="product-container">

  <!-- Error Message Display -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading">
    Loading...
  </div>

  <!-- Add New Product -->
  <div class="new-product-section">
    <button (click)="toggleAddProductForm()" class="new-product-button">
      {{ showAddForm ? 'Cancel' : 'New Product' }}
    </button>

    <!-- Floating Form -->
    <div *ngIf="showAddForm" class="floating-form">
      <form (ngSubmit)="createProduct()" #productForm="ngForm" class="add-product-form">
        
        <div class="input-group">
          <input
            type="text"
            name="productName"
            [(ngModel)]="newProduct.productName"
            placeholder="Enter product name"
            required
            [disabled]="isLoading"
            class="input-field"
          />
        </div>

        <div class="input-group">
          <select [(ngModel)]="newProduct.categoryName" name="category" required [disabled]="isLoading" class="input-field">
            <option value="" disabled selected>Select a Category</option>
            <option *ngFor="let category of categories" [value]="category.categoryName">
              {{ category.categoryName }}
            </option>
          </select>
        </div>

        <div class="input-group">
          <input [(ngModel)]="newProduct.price" name="price" type="number" placeholder="Enter price" required [disabled]="isLoading" class="input-field" />
        </div>

        <!-- File Input for Image -->
        <div class="input-group">
          <input type="file" (change)="onFileSelected($event)" [disabled]="isLoading" class="input-field" /><br />
        </div>

        <button type="submit" [disabled]="!newProduct.productName || !newProduct.categoryName || !newProduct.price || isLoading" class="submit-button">
          Create Product
        </button>
      </form>
    </div>
  </div>

  <!-- Products Table -->
  <table class="product-table" *ngIf="products.length > 0; else noProducts">
    <thead>
      <tr>
        <th>Product Code</th>
        <th>Picture</th>
        <th>Product Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of products; let i = index">
        <td>{{ i + 1 }}</td>
        <td>
          <!-- Product Image Display -->
<div class="product-image">
  <img *ngIf="product.image" [src]="'data:image/jpeg;base64,' + product.image" alt="{{ product.productName }}">
  <img *ngIf="product.imageUrl && !product.image" [src]="product.imageUrl" alt="{{ product.productName }}">
  <ng-template #noImage>
    <p>No image available</p>
  </ng-template>
</div>

          <div *ngIf="product.isEditing">
            <input type="file" (change)="onFileSelected($event, product)" [disabled]="isLoading" class="input-field" />
          </div>
        </td>

        <td>
          <div *ngIf="!product.isEditing">{{ product.productName }}</div>
          <div *ngIf="product.isEditing">
            <input [(ngModel)]="product.productName" [disabled]="isLoading" class="input-field" placeholder="Edit product name" />
          </div>
        </td>

        <td>
          <div *ngIf="!product.isEditing">{{ product.categoryName }}</div>
          <div *ngIf="product.isEditing">
            <select [(ngModel)]="product.categoryName" [disabled]="isLoading" class="input-field">
              <option value="" disabled selected>Select a Category</option>
              <option *ngFor="let category of categories" [value]="category.categoryName">
                {{ category.categoryName }}
              </option>
            </select>
          </div>
        </td>

        <td>
          <div *ngIf="!product.isEditing">â‚±{{ product.price }}</div>
          <div *ngIf="product.isEditing">
            <input [(ngModel)]="product.price" type="number" [disabled]="isLoading" class="input-field" placeholder="Edit price" />
          </div>
        </td>

        <td>
          <div *ngIf="!product.isEditing" class="action-buttons">
            <button (click)="enableEdit(product)" [disabled]="isLoading" class="action-button">Edit</button>
            <button (click)="deleteProduct(product.productID)" [disabled]="isLoading" class="action-button">Delete</button>
          </div>
          <div *ngIf="product.isEditing" class="action-buttons">
            <button (click)="updateProduct(product)" [disabled]="isLoading" class="action-button">Save</button>
            <button (click)="cancelEdit(product)" [disabled]="isLoading" class="action-button">Cancel</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Message if No Products -->
  <ng-template #noProducts>
    <p class="no-products-message">No products available.</p>
  </ng-template>

</div>
