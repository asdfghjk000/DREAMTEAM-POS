<div class="product-container">

  <!-- Error Message Display -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading">
    Loading...
  </div>

  <!-- Add New Product -->
  <div class="new-product-section">
    <button (click)="toggleAddProductForm()" class="new-product-button">
      {{ showAddForm ? 'New Product' : 'New Product' }}
    </button>

    <!-- Floating Form -->
    <div *ngIf="showAddForm" class="floating-form">
      <form (ngSubmit)="createProduct()" #productForm="ngForm" class="add-product-form">
        <input
          type="text"
          name="productName"
          [(ngModel)]="newProduct.productName"
          placeholder="Enter product name"
          required
          [disabled]="isLoading"
        />
        <select [(ngModel)]="newProduct.categoryName" name="category" required [disabled]="isLoading">
          <option value="" disabled selected>Select a Category</option>
          <option *ngFor="let category of categories" [value]="category.categoryName">
            {{ category.categoryName }}
          </option>
        </select>
        <div class="price-input">
          <input [(ngModel)]="newProduct.price" name="price" type="number" placeholder="Enter price" required [disabled]="isLoading" />
        </div>
        
        <!-- File Input for Image -->
        <input type="file" (change)="onFileSelected($event)" [disabled]="isLoading" /><br />

        <button type="submit" [disabled]="!newProduct.productName || !newProduct.categoryName || !newProduct.price || isLoading">
          Create Product
        </button>
      </form>
    </div>
  </div>

  <!-- Products Table -->
  <table class="product-table" *ngIf="products.length > 0; else noProducts">
    <thead>
      <tr>
        <th>Product Code</th>
        <th>Picture</th> <!-- Picture Column -->
        <th>Product Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of products; let i = index">
        <td>{{ i + 1 }}</td>
        <!-- Product Image Preview -->
<td>
  <div *ngIf="!product.isEditing">
    <!-- Display the product's image if it exists -->
    <img *ngIf="product.imageUrl" [src]="product.imageUrl" alt="Product Image" class="product-image-icon" />
    <!-- Display a default image if no image uploaded yet -->
    <img *ngIf="!product.imageUrl" src="assets/default-image.jpg" alt="Default Image" class="product-image-icon" />
  </div>

  <div *ngIf="product.isEditing">
    <!-- Display file input when editing the product -->
    <input type="file" (change)="onFileSelected($event, product)" [disabled]="isLoading" />
  </div>
</td>

        <td>
          <div *ngIf="!product.isEditing">{{ product.productName }}</div>
          <div *ngIf="product.isEditing">
            <input [(ngModel)]="product.productName" [disabled]="isLoading" placeholder="Edit product name" />
          </div>
        </td>
        <td>
          <div *ngIf="!product.isEditing">{{ product.categoryName }}</div>
          <div *ngIf="product.isEditing">
            <select [(ngModel)]="product.categoryName" [disabled]="isLoading">
              <option value="" disabled selected>Select a Category</option>
              <option *ngFor="let category of categories" [value]="category.categoryName">
                {{ category.categoryName }}
              </option>
            </select>
          </div>
        </td>
        <td>
          <div *ngIf="!product.isEditing">â‚±{{ product.price }}</div>
          <div *ngIf="product.isEditing">
            <input [(ngModel)]="product.price" type="number" [disabled]="isLoading" placeholder="Edit price" />
          </div>
        </td>
        <td>
          <div *ngIf="!product.isEditing" class="action-buttons">
            <button (click)="enableEdit(product)" [disabled]="isLoading">Edit</button>
            <button (click)="deleteProduct(product.productID)" [disabled]="isLoading">Delete</button>
          </div>
          <div *ngIf="product.isEditing" class="action-buttons">
            <button (click)="updateProduct(product)" [disabled]="isLoading">Save</button>
            <button (click)="cancelEdit(product)" [disabled]="isLoading">Cancel</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Message if No Products -->
  <ng-template #noProducts>
    <p class="no-categories">No products available.</p>
  </ng-template>
</div>
